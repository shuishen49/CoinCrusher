# CoinGenerator 系统设置指南

## 功能概述
新的 CoinGenerator 系统实现了以下核心功能：
- **预览功能**：在点击按钮前，预先生成一个金币并让它跟随生成点，但不具备物理效果
- **触摸移动**：用手指在屏幕上滑动来移动金币的生成点 CoinSpawnPoint
- **范围限制**：将生成点的移动限制在指定的坐标范围内
- **按钮触发**：将生成金币的逻辑从"鼠标点击屏幕"改为"点击UI按钮"

## 设置步骤

### 1. 预制体准备 (非常重要)
请确保您的每一个金币预制体 (Prefab) 上都已经添加了 **RigidBody (刚体)** 组件。这样，当 `useGravity` 设为 `true` 时，它才能够受重力影响而下落。

**检查步骤：**
1. 在 Project 面板中找到您的金币预制体
2. 双击打开预制体
3. 在 Inspector 面板中点击 "Add Component"
4. 搜索并添加 "RigidBody" 组件
5. 确保 RigidBody 的默认设置正确（通常保持默认即可）

### 2. 场景设置

#### 挂载脚本
将修改后的 `CoinGenerator.ts` 脚本挂载到您的 `CoinSpawnPoint` 节点上。

#### 设置属性
在 **属性检查器 (Inspector)** 中，点击 `CoinSpawnPoint` 节点，您会看到脚本的各个属性：

**基础设置：**
- **Coin Prefabs**: 将您所有的金币预制体拖拽到这个数组里
- **Coin Container**: 将您场景中用于存放所有已生成金币的那个父节点拖拽到这里
- **Drop Button**: 将您的"落下"按钮拖拽到这里，用于在延迟期间禁用它

**移动范围设置：**
- **Min Z**: Z轴最小坐标 (默认: -5.019)
- **Max Z**: Z轴最大坐标 (默认: -2.003)

**移动灵敏度：**
- **Move Sensitivity**: 可以调整手指移动时生成点的移动速度 (默认: 0.01)

**物理效果设置：**
- **Min Angular Factor**: 下落时随机角速度因子的最小值 (默认: 1)
- **Max Angular Factor**: 下落时随机角速度因子的最大值 (默认: 5)

### 3. 连接 UI 按钮

这是将"落下"按钮和我们的脚本关联起来的关键一步。

**详细步骤：**
1. 在 **层级管理器 (Hierarchy)** 中，找到您的那个写着"落下"的 Button 节点
2. 在 **属性检查器 (Inspector)** 中，找到 Button 组件
3. 您会看到一个名为 **Click Events** 的属性，点击右下角的 **+** 号来添加一个新事件
4. 将 **层级管理器** 中的 `CoinSpawnPoint` 节点 **拖拽** 到 Click Events 下新增事件的 `cc.Node` 属性框里
5. 点击第二个下拉菜单，选择 `CoinGenerator`
6. 点击第三个下拉菜单，选择我们新写的公开方法：`dropCoin`

## 运行效果

完成设置后，运行游戏，您应该能看到：

1. **游戏开始时**：一个随机的金币会出现在 `CoinSpawnPoint` 的位置，并具有随机的初始旋转
2. **触摸移动**：您用手指在屏幕上**左右滑动**，`CoinSpawnPoint` 和它上面的预览金币会一起在 Z 轴方向上移动（前后移动）
3. **按钮触发**：当您点击UI上的"落下"按钮时：
   - 按钮立即变为不可点击状态（变灰）
   - 预览的金币会脱离生成点并开始下落，保持其初始旋转姿态
   - 金币下落时会根据设置的角速度因子进行自然翻滚
   - **0.5秒后**，新的预览金币才会出现，同时按钮恢复可点击状态

## 技术细节

### 预览机制
- 预览金币被设置为 `isKinematic = true`，不受物理影响
- 预览金币的 `useGravity = false`，不会下落
- 预览金币作为 `CoinSpawnPoint` 的子节点，跟随移动
- **重要更新**：预览金币在创建时就具有随机的初始旋转

### 物理激活
- 当点击按钮时，金币的 `isKinematic` 被设置为 `false`
- `useGravity` 被设置为 `true`，开始受重力影响
- 金币脱离预览状态，开始正常下落
- **重要修正**：使用 `getWorldPosition()` 和 `setWorldPosition()` 确保金币落下位置绝对准确
- **新增功能**：设置随机的 `angularFactor`，让金币下落时进行自然翻滚

### 移动控制
- 使用 `TOUCH_MOVE` 事件监听手指移动
- **重要更新**：使用手指左右滑动（delta.x）来控制 Z 轴移动
- CoinSpawnPoint 只能在 Z 轴上移动，忽略 Y 轴移动
- 使用 `math.clamp()` 函数限制 Z 轴移动范围

### 延迟机制
- 使用 `_isDropping` 状态标记防止重复触发
- 点击按钮后立即禁用按钮（`interactable = false`）
- 使用 `setTimeout` 延迟 0.5 秒后生成下一个预览
- 延迟结束后重新启用按钮（`interactable = true`）

## 故障排除

### 常见问题

**Q: 金币不跟随生成点移动**
A: 检查预览金币是否正确设置为 `CoinSpawnPoint` 的子节点

**Q: 金币点击按钮后不下落**
A: 确保金币预制体上有 RigidBody 组件，且脚本正确设置了物理属性

**Q: 金币落下位置不准确**
A: 脚本已修正，使用 `getWorldPosition()` 和 `setWorldPosition()` 确保位置精确

**Q: 移动范围不正确**
A: 检查 `minZ`, `maxZ` 的值是否设置正确

**Q: 按钮点击无反应**
A: 检查 Button 的 Click Events 是否正确连接到 `dropCoin` 方法

**Q: 按钮在延迟期间仍然可以点击**
A: 确保已将"落下"按钮正确拖拽到脚本的 Drop Button 属性中

**Q: 金币翻滚效果不明显**
A: 调整 Min Angular Factor 和 Max Angular Factor 的值，数值越大翻滚效果越明显

### 调试技巧
- 打开浏览器控制台查看日志输出
- 使用 `console.log()` 检查各个步骤是否正确执行
- 在 Scene 视图中观察节点层级关系

## 自定义扩展

您可以根据需要进一步自定义：

1. **添加音效**：在 `dropCoin()` 方法中添加音效播放
2. **粒子效果**：在金币落下时添加粒子特效
3. **动画效果**：为预览金币添加旋转或缩放动画
4. **多币种**：扩展系统支持更多类型的金币

---

**注意**：如果您在使用过程中遇到任何问题，请检查控制台输出的警告信息，这些信息会帮助您快速定位问题所在。
